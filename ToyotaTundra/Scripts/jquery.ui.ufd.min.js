(function(n){var i="ui.ufd",t;n.widget(i,{_init:function(){this.created||this._create()},_create:function(){var t;if(!this.created){if(this.created=!0,this.element[0].tagName.toLowerCase()!="select")return this.destroy(),!1;this.options=n.extend(!0,{},this.options);this.visibleCount=0;this.selectbox=this.element;this.logNode=n(this.options.logSelector);this.overflowCSS=this.options.allowLR?"overflow":"overflowY";var u=this.selectbox.attr("name"),f=this.options.prefix+u,e=this.options.submitFreeText?u:f,i="",r=this.selectbox.attr("id");r&&(i=this.options.prefix+r,this.labels=n("label[for='"+r+"']").attr("for",i));this.options.submitFreeText&&this.selectbox.attr("name",f);this.options.calculateZIndex&&(this.options.zIndexPopup=this._calculateZIndex());t=this.options.css;this.css=this.options.css;this.options.useUiCss&&n.extend(this.css,this.options.uiCss);t.skin||(t.skin=this.options.skin);this.wrapper=n(['<span class="',t.wrapper," ",t.hidden," ",t.skin,'">','<input type="text" id="',i,'" class="',t.input,'" name="',e,'"/>','<button type="button" tabindex="-1" class="',t.button,'"><div class="',t.buttonIcon,'"/><\/button>',"<\/span>"].join(""));this.dropdown=n(['<div class="',t.skin,'">','<div class="',t.listWrapper," ",t.hidden,'">','<div class="',t.listScroll,'">',"<\/div>","<\/div>","<\/div>"].join(""));this.selectbox.after(this.wrapper);this.getDropdownContainer().append(this.dropdown);this.input=this.wrapper.find("input");this.button=this.wrapper.find("button");this.listWrapper=this.dropdown.children(":first").css("z-index",this.options.zIndexPopup);this.listScroll=this.listWrapper.children(":first");n.fn.bgiframe&&this.listWrapper.bgiframe();this.options.listWidthFixed||(this.listWrapper.css({width:50,"min-width":100}),this.options.listWidthFixed=this.listWrapper.width()<100,this.listWrapper.css({width:null,"min-width":null}));this._populateFromMaster();this._initEvents()}},_initEvents:function(){var t=this,r=n.ui.keyCode,u,s,e,o,f=this.options.css;this.input.bind("keydown keypress keyup",function(n){if(s=n.type=="keydown",e=n.type=="keypress",o=n.type=="keyup",u=null,undefined===n.which)u=n.keyCode;else{if(e||n.which==0)return;u=n.keyCode}switch(u){case r.HOME:case r.END:if(t.options.homeEndForCursor)return;case r.DOWN:case r.PAGE_DOWN:case r.UP:case r.PAGE_UP:case r.ENTER:t.stopEvent(n)}if(!o!=(u!=r.TAB&&u!=r.ENTER)){t.lastKey=u;switch(u){case r.SHIFT:case r.CONTROL:break;case r.DOWN:t.selectNext(!1);break;case r.PAGE_DOWN:t.selectNext(!0);break;case r.END:t.selectLast();break;case r.UP:t.selectPrev(!1);break;case r.PAGE_UP:t.selectPrev(!0);break;case r.HOME:t.selectFirst();break;case r.ENTER:t.hideList();t.tryToSetMaster();t.inputFocus();break;case r.TAB:t.realLooseFocusEvent();break;case r.ESCAPE:t.hideList();t.revertSelected();break;default:t.showList();t.filter(!1,!0)}}});this.input.bind("click",function(n){if(t.isDisabled){t.stopEvent(n);return}t.listVisible()||(t.filter(!0),t.inputFocus(),t.showList())});this.input.bind("focus",function(n){if(t.isDisabled){t.stopEvent(n);return}t.internalFocus||t.realFocusEvent()});this.button.bind("mouseover",function(){t.button.addClass(f.buttonHover)});this.button.bind("mouseout",function(){t.button.removeClass(f.buttonHover)});this.button.bind("mousedown",function(){t.button.addClass(f.buttonMouseDown)});this.button.bind("mouseup",function(){t.button.removeClass(f.buttonMouseDown)});this.button.bind("click",function(n){if(t.isDisabled){t.stopEvent(n);return}t.listVisible()?(t.hideList(),t.inputFocus()):(t.filter(!0),t.inputFocus(),t.showList())});this.listScroll.bind("DOMMouseScroll mousewheel",function(n){t.stopEvent(n);n=n?n:window.event;var i=n.detail?n.detail*-1:n.wheelDelta/40,r=t.listScroll.scrollTop(),u=r+(i>0?-1*t.itemHeight:1*t.itemHeight);t.listScroll.scrollTop(u)});this.listScroll.bind("mouseover mouseout click",function(i){if("LI"==i.target.nodeName.toUpperCase())if(t.setActiveTimeout&&(clearTimeout(t.setActiveTimeout),t.setActiveTimeout==null),"mouseout"==i.type)n(i.target).removeClass(f.liActive),t.setActiveTimeout=setTimeout(function(){n(t.selectedLi).addClass(f.liActive)},t.options.delayYield);else if("mouseover"==i.type)t.selectedLi!=i.target&&n(t.selectedLi).removeClass(f.liActive),n(i.target).addClass(f.liActive);else{t.stopEvent(i);var r=n.trim(n(i.target).text());t.input.val(r);t.setActive(i.target);t.tryToSetMaster()&&(t.hideList(),t.filter(!0));t.inputFocus()}return!0});this.selectbox.bind("change."+i,function(){if(t.isUpdatingMaster)return t.isUpdatingMaster=!1,!0;t.revertSelected()});this._myDocClickHandler=function(n){t.button.get(0)!=n.target&&t.input.get(0)!=n.target&&t.internalFocus&&t.realLooseFocusEvent()};n(document).bind("click."+i,this._myDocClickHandler);this.options.polling&&(t=this,this._myPollId=setInterval(function(){t.dimensioned||t.setDimensions();t.selectbox[0].disabled!=t.isDisabled&&(t.selectbox[0].disabled?t.disable():t.enable())},t.options.polling))},realFocusEvent:function(){this.internalFocus=!0;this._triggerEventOnMaster("focus");this.wrapper.addClass(this.options.css.skin+"-"+this.options.css.inputFocus);this.input.addClass(this.options.css.inputFocus);this.button.addClass(this.options.css.inputFocus);this.filter(!0);this.inputFocus();this.showList()},realLooseFocusEvent:function(){this.internalFocus=!1;this.hideList();this.wrapper.removeClass(this.options.css.skin+"-"+this.options.css.inputFocus);this.input.removeClass(this.options.css.inputFocus);this.button.removeClass(this.options.css.inputFocus);this.tryToSetMaster();this._triggerEventOnMaster("blur")},_triggerEventOnMaster:function(n){if(document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent(n,!0,!0);this.selectbox.get(0).dispatchEvent(t)}else document.createEventObject&&this.selectbox.get(0).fireEvent("on"+n)},inputFocus:function(){this.input.focus();this.getCurrentTextValue().length&&this.selectAll()},inputBlur:function(){this.input.blur()},showList:function(){this.listVisible()||(this.listWrapper.removeClass(this.css.hidden),this.setListDisplay())},hideList:function(){this.listVisible()&&(this.listWrapper.addClass(this.css.hidden),this.listItems.removeClass(this.css.hidden))},filter:function(n,t){var i=this;this.updateOnTimeout&&clearTimeout(this.updateOnTimeout);this.filterOnTimeout&&clearTimeout(this.filterOnTimeout);this.updateOnTimeout=null;this.filterOnTimeout=null;var r=i.getCurrentTextValue(),u=function(){var n=i.trie.find(r);i.trie.matches=n.matches;i.trie.misses=n.misses;i.updateOnTimeout=setTimeout(function(){f()},i.options.delayYield)},f=function(){var t=i.getActive(),u,f;i.options.addEmphasis&&i.emphasis(i.trie.matches,!0,r);i.visibleCount=i.overwriteClass(i.trie.matches,"");n||!i.trie.matches.length?(i.visibleCount+=i.overwriteClass(i.trie.misses,""),i.options.addEmphasis&&i.emphasis(i.trie.misses,!1,r)):i.overwriteClass(i.trie.misses,i.css.hidden);u=t.hasClass(i.css.hidden);!u&&t.length&&i.trie.matches.length?i.setActive(t.get(0)):(f=i.listItems.filter(":visible:first"),i.setActive(f.get(0)));i.setListDisplay()};t?this.filterOnTimeout=setTimeout(function(){u()},this.options.delayFilter):u()},_encodeDom:n("<div/>"),_encodeString:function(t){return n.trim(this._encodeDom.text(t).html())},emphasis:function(t,i,r){var u,f,e,o,s,h,c,l=r.length||0,a=this.selectbox.get(0).options;for(f=t.length,i=i&&l>0,i&&(c=this._encodeString(r).replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1"),h=new RegExp("("+c+")","gi"),this.hasEmphasis=!0);f--;)for(u=t[f],e=u.length;e--;)o=u[e],s=n.trim(a[o.getAttribute("name")].innerHTML),o.innerHTML=i?s.replace(h,"<em>$1<\/em>"):s},_timingMeasure_firebug:function(n,t){n?console.time(t):console.timeEnd(t)},_timingMeasure:function(n,t){this._timingMeasure_firebug(n,t)},removeEmphasis:function(){var t;if(this.hasEmphasis){this.hasEmphasis=!1;for(var u=this.selectbox.get(0).options,i=this.list.get(0).getElementsByTagName("LI"),r=i.length,t;r--;)t=i[r],t.innerHTML=n.trim(u[t.getAttribute("name")].innerHTML)}},tryToSetMaster:function(){var n=null,i=this.getActive();if(i.length&&(n=i.attr("name")),n==null||n==""||n<0)return this.options.submitFreeText?!1:(this.revertSelected(),!1);var t=this.selectbox.get(0),u=t.selectedIndex,r=t.options[n];return!this.options.submitFreeText||this.input.val()==r.text?(this.input.val(r.text),n!=u&&(this.isUpdatingMaster=!0,t.selectedIndex=n,this._triggerEventOnMaster("change")),!0):!1},_populateFromMaster:function(){var h=!this.selectbox.filter("[disabled]").length,s,i,e,r,o,u,f;for(this.disable(),this.trie=new t(this.options.infix,this.options.caseSensitive),this.trie.matches=[],this.trie.misses=[],s=this,i=[],i.push("<ul>"),e=this.selectbox.get(0).options,o=e.length,u=0;o--;)r=e[u++],i.push('<li name="'),i.push(r.index),i.push('">'),i.push(n.trim(r.innerHTML)),i.push("<\/li>");for(i.push("<\/ul>"),this.listScroll.html(i.join("")),this.list=this.listScroll.find("ul:first"),f=this.list.get(0).getElementsByTagName("LI"),this.listItems=n(f),o=f.length,u=0;o--;)r=e[u],s.trie.add(n.trim(r.text),f[u++]);this.visibleCount=f.length;this.setInputFromMaster();this.selectedLi=null;this.dimensioned=!1;this.setDimensions();h&&this.enable();this._moveAttrs(this.selectbox,this.input,this.options.moveAttrs)},_moveAttrs:function(n,t,i){for(var u,f,r=0;r<i.length;++r)u=i[r],f=n.attr(u),f&&(t.attr(u,f),n.removeAttr(u))},setDimensions:function(){var n,t,i,r;if((this.selectIsWrapped||this.selectbox.filter(":visible").length)&&(!this.selectIsWrapped||this.wrapper.filter(":visible").length)){this.wrapper.addClass(this.css.hidden);this.selectIsWrapped&&(!this.options.manualWidth||this.options.unwrapForCSS)&&(this.wrapper.before(this.selectbox),this.selectIsWrapped=!1);this.options.manualWidth?n=this.options.manualWidth:(n=this.selectbox.outerWidth(),n<this.options.minWidth?n=this.options.minWidth:this.options.maxWidth&&n>this.options.maxWidth&&(n=this.options.maxWidth));t=this.options.mimicCSS;for(propPtr in t)(i=t[propPtr],t.hasOwnProperty(propPtr)&&typeof i!="function")&&this.wrapper.css(i,this.selectbox.css(i));this.selectIsWrapped||(this.wrapper.get(0).appendChild(this.selectbox.get(0)),this.selectIsWrapped=!0);this.wrapper.removeClass(this.css.hidden);this.listWrapper.removeClass(this.css.hidden);var f=this.button.outerWidth(!0),u=this.wrapper.outerWidth()-this.wrapper.width(),e=this.input.outerWidth(!0)-this.input.width(),o=this.listScroll.outerWidth()-this.listScroll.width(),s=n-f-e;this.input.width(s);this.wrapper.width(n);r=this.options.listWidthFixed?"width":"min-width";this.listWrapper.css(r,n+u);this.listScroll.css(r,n+u-o);this.listWrapper.addClass(this.css.hidden);this.dimensioned=!0}},setInputFromMaster:function(){var n=this.selectbox.get(0),t="";try{t=n.options[n.selectedIndex].text}catch(i){}this.input.val(t)},revertSelected:function(){this.setInputFromMaster();this.filter(!0)},setListDisplay:function(){var t,i;this.itemHeight||(this.itemHeight=this.listItems.filter("li:first").outerHeight(!0));this.visibleCount>this.options.listMaxVisible?(t=this.options.listMaxVisible*this.itemHeight,this.listScroll.css(this.overflowCSS,"scroll")):(t=this.visibleCount*this.itemHeight,this.listScroll.css(this.overflowCSS,"hidden"));this.listScroll.height(t);i=this.listScroll.outerHeight();this.listWrapper.height(i);var r=this.wrapper.offset(),f=this.wrapper.outerHeight(),e=r.top+f+i,o=n(window).height()+n(document).scrollTop(),s=e>o,h=r.left,u;return s?(this.listWrapper.addClass(this.css.listWrapperUp),u=r.top-i):(this.listWrapper.removeClass(this.css.listWrapperUp),u=r.top+f),this.listWrapper.css("left",h),this.listWrapper.css("top",u),this.scrollTo(),t},getActive:function(){return this.selectedLi==null?n([]):n(this.selectedLi)},setActive:function(t){n(this.selectedLi).removeClass(this.css.liActive);this.selectedLi=t;n(this.selectedLi).addClass(this.css.liActive)},selectFirst:function(){var n=this.listItems.filter(":not(.invisible):first");this.afterSelect(n)},selectLast:function(){var n=this.listItems.filter(":not(.invisible):last");this.afterSelect(n)},selectPrev:function(n){var t=n?this.options.pageLength:1,i=this.searchRelativeVisible(!1,t);this.afterSelect(i)},selectNext:function(n){var t=n?this.options.pageLength:1,i=this.searchRelativeVisible(!0,t);this.afterSelect(i)},afterSelect:function(n){n!=null&&(this.setActive(n),this.input.val(n.text()),this.scrollTo(),this.tryToSetMaster(),this.inputFocus(),this.removeEmphasis())},searchRelativeVisible:function(n,t){var r=this.getActive(),i;if(!r.length)return this.selectFirst(),null;do{i=r;do i=n?i.next():i.prev();while(i.length&&i.hasClass(this.css.hidden));i.length&&(r=i)}while(--t);return r},scrollTo:function(){var n;if("scroll"!=this.listScroll.css(this.overflowCSS)||(n=this.getActive(),!n.length))return!1;var t=Math.floor(n.position().top),r=n.outerHeight(!0),f=this.listWrapper.height(),e=this.listScroll.scrollTop(),u,i=this.options.viewAhead*r;if(t<i)u=e+t-i;else if(t+r>=f-i)u=e+t-f+r+i;else return!1;return this.listScroll.scrollTop(u),!0},getCurrentTextValue:function(){return n.trim(this.input.val())},stopEvent:function(n){n=n?n:window.event;n.cancel=!0;n.cancelBubble=!0;n.returnValue=!1;n.stopPropagation&&n.stopPropagation();n.preventDefault&&n.preventDefault()},overwriteClass:function(t,i){for(var u,r,e=0,f=t.length;f--;)for(u=t[f],r=u.length,e+=r;r--;)u[r].setAttribute(n.ui.ufd.classAttr,i);return e},listVisible:function(){return!this.listWrapper.hasClass(this.css.hidden)},disable:function(){this.hideList();this.isDisabled=!0;this.button.addClass(this.css.buttonDisabled);this.input.addClass(this.css.inputDisabled);this.input.attr("disabled","disabled");this.selectbox.attr("disabled","disabled")},enable:function(){this.isDisabled=!1;this.button.removeClass(this.css.buttonDisabled);this.input.removeClass(this.css.inputDisabled);this.input.removeAttr("disabled");this.selectbox.removeAttr("disabled")},selectAll:function(){this.input.get(0).select()},getDropdownContainer:function(){var t=n("#"+this.options.dropDownID);return t.length||(t=n("<div><\/div>").appendTo("body").css("height",0).attr("id",this.options.dropDownID)),t},log:function(n){this.options.log&&(window.console&&window.console.log&&console.log(n),this.logNode&&this.logNode.length&&this.logNode.prepend("<div>"+n+"<\/div>"))},_calculateZIndex:function(){var t,i=this.options.zIndexPopup;return this.selectbox.parents().each(function(){t=parseInt(n(this).css("zIndex"),10);t>i&&(i=t)}),i+1},changeOptions:function(){this._populateFromMaster()},destroy:function(){this.selectIsWrapped&&this.wrapper.before(this.selectbox);this._moveAttrs(this.input,this.selectbox,this.options.moveAttrs);this.labels.attr("for",this.selectbox.attr("id"));this.labels=null;this.selectbox.unbind("change."+i);n(document).unbind("click."+i,this._myDocClickHandler);this._myPollId&&clearInterval(this._myPollId);this.wrapper.remove();this.listWrapper.remove();n.ui.version<"1.8"?(this.selectbox.unbind("setData."+i),this.selectbox.unbind("getData."+i),this.selectbox.unbind("remove"),n.widget.prototype.destroy.apply(this,arguments)):n.Widget.prototype.destroy.apply(this,arguments);this.selectbox=null;this._encodeDom=null},dimensioned:!1,selectIsWrapped:!1,internalFocus:!1,lastKey:null,selectedLi:null,isUpdatingMaster:!1,created:!1,hasEmphasis:!1,isDisabled:!1});t=function(n,t){this.isInfix=!!n;this.isCaseSensitive=!!t;this.root=[null,{},!1];this.infixRoots=n?{}:null};t.prototype.add=function(n,t){var e,i,r,u,f;for(n=this.cleanString(n),e=n.length,i=this.root,f=0;f<e;f++)r=n.charAt(f),u=i[1],r in u?i=u[r]:(i=u[r]=[null,{},this.root[2]],this.isInfix&&(r in this.infixRoots?this.infixRoots[r].push(i):this.infixRoots[r]=[i]));return i[0]?i[0].push(t):i[0]=[t],!0};t.prototype.find=function(n){var t=this.findNodeArray(n),r=!this.root[2],u=[],f=[],i;for(arrName in t)(i=t[arrName],t.hasOwnProperty(arrName)&&typeof i!="function")&&this.markAndRetrieve(u,i,r);return this.markAndRetrieve(f,this.root,r),{matches:u,misses:f}};t.prototype.findNodeArray=function(n){var n=this.cleanString(n),i=[this.root],f=n.length,r,t,u;for(this.cache=this.cache||{},t=this.cache,u=0;u<f;u++)r=n.charAt(u),t.chr==r?i=t.hit:(i=this.mapNewArray(i,r),t.chr=r,t.hit=i,t.next={}),t=t.next;return i};t.prototype.mapNewArray=function(n,t){var r,u,e,f,i;if(n.length&&n[0]==this.root)return this.isInfix?this.infixRoots[t]||[]:(r=this.root[1][t],r?[r]:[]);for(u=[],e=n.length,i=0;i<e;i++)f=n[i][1],f.hasOwnProperty(t)&&u.push(f[t]);return u};t.prototype.markAndRetrieve=function(n,t,i){for(var u=[t],r;u.length>0;)if(r=u.pop(),r[2]!=i){r[2]=i;r[0]&&n.unshift(r[0]);for(chr in r[1])r[1].hasOwnProperty(chr)&&u.push(r[1][chr])}};t.prototype.cleanString=function(n){return this.isCaseSensitive||(n=n.toLowerCase()),n};n.ui.ufd.getNewTrie=function(n,i){return new t(n,i)};n.extend(n.ui.ufd,{version:"0.6",getter:"",classAttr:n.support.style?"class":"className",defaults:{skin:"plain",prefix:"ufd-",dropDownID:"ufd-container",logSelector:"#log",mimicCSS:["float","tabindex","marginLeft","marginTop","marginRight","marginBottom"],moveAttrs:["tabindex","title"],infix:!0,addEmphasis:!1,caseSensitive:!1,submitFreeText:!1,homeEndForCursor:!1,allowLR:!1,calculateZIndex:!1,useUiCss:!1,log:!1,unwrapForCSS:!1,listWidthFixed:!0,polling:250,listMaxVisible:10,minWidth:50,maxWidth:null,manualWidth:null,viewAhead:1,pageLength:10,delayFilter:n.support.style?1:150,delayYield:1,zIndexPopup:101,css:{input:"",inputDisabled:"disabled",inputFocus:"focus",button:"",buttonIcon:"icon",buttonDisabled:"disabled",buttonHover:"hover",buttonMouseDown:"mouseDown",li:"",liActive:"active",hidden:"invisible",wrapper:"ufd",listWrapper:"list-wrapper",listWrapperUp:"list-wrapper-up",listScroll:"list-scroll"},uiCss:{skin:"uiCss",input:"ui-widget-content",inputDisabled:"disabled",button:"ui-button",buttonIcon:"ui-icon ui-icon-triangle-1-s",buttonDisabled:"disabled",buttonHover:"ui-state-focus",buttonMouseDown:"ui-state-active",li:"ui-menu-item",liActive:"ui-state-hover",hidden:"invisible",wrapper:"ufd ui-widget ui-widget-content",listWrapper:"list-wrapper ui-widget ui-widget",listWrapperUp:"list-wrapper-up",listScroll:"list-scroll ui-widget-content"}}});n.ui.ufd.prototype.options=n.ui.ufd.defaults})(jQuery);