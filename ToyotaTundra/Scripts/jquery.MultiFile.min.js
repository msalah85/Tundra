window.jQuery&&function(n){n.fn.MultiFile=function(t){var i,t;if(this.length==0)return this;if(typeof arguments[0]=="string")return this.length>1?(i=arguments,this.each(function(){n.fn.MultiFile.apply(n(this),i)})):(n.fn.MultiFile[arguments[0]].apply(this,n.makeArray(arguments).slice(1)||[]),this);t=n.extend({},n.fn.MultiFile.options,t||{});n("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(n.fn.MultiFile.disableEmpty);n.fn.MultiFile.options.autoIntercept&&(n.fn.MultiFile.intercept(n.fn.MultiFile.options.autoIntercept),n.fn.MultiFile.options.autoIntercept=null);this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){var u,i,r;window.MultiFile=(window.MultiFile||0)+1;u=window.MultiFile;i={e:this,E:n(this),clone:n(this).clone()};typeof t=="number"&&(t={max:t});r=n.extend({},n.fn.MultiFile.options,t||{},(n.metadata?i.E.metadata():n.meta?i.E.data():null)||{},{});r.max>0||(r.max=i.E.attr("maxlength"),r.max>0||(r.max=(String(i.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],r.max=r.max>0?String(r.max).match(/[0-9]+/gi)[0]:-1));r.max=new Number(r.max);r.accept=r.accept||i.E.attr("accept")||"";r.accept||(r.accept=i.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",r.accept=new String(r.accept).replace(/^(accept|ext)\-/i,""));n.extend(i,r||{});i.STRING=n.extend({},n.fn.MultiFile.options.STRING,i.STRING);n.extend(i,{n:0,slaves:[],files:[],instanceKey:i.e.id||"MultiFile"+String(u),generateID:function(n){return i.instanceKey+(n>0?"_F"+String(n):"")},trigger:function(t,r){var f=i[t],e=n(r).attr("value"),u;return f&&(u=f(r,e,i),u!=null)?u:!0}});String(i.accept).length>1&&(i.accept=i.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),i.rxAccept=new RegExp("\\.("+(i.accept?i.accept:"")+")$","gi"));i.wrapID=i.instanceKey+"_wrap";i.E.wrap('<div class="MultiFile-wrap" id="'+i.wrapID+'"><\/div>');i.wrapper=n("#"+i.wrapID+"");i.e.name=i.e.name||"file"+u+"[]";i.list||(i.wrapper.append('<div class="MultiFile-list" id="'+i.wrapID+'_list"><\/div>'),i.list=n("#"+i.wrapID+"_list"));i.list=n(i.list);i.addSlave=function(t,r){i.n++;t.MultiFile=i;r>0&&(t.id=t.name="");r>0&&(t.id=i.generateID(r));t.name=String(i.namePattern.replace(/\$name/gi,n(i.clone).attr("name")).replace(/\$id/gi,n(i.clone).attr("id")).replace(/\$g/gi,u).replace(/\$i/gi,r));i.max>0&&i.n-1>i.max&&(t.disabled=!0);i.current=i.slaves[r]=t;t=n(t);t.val("").attr("value","")[0].value="";t.addClass("MultiFile-applied");t.change(function(){var e,u,o,f;if(n(this).blur(),!i.trigger("onFileSelect",this,i))return!1;e="";u=String(this.value||"");i.accept&&u&&!u.match(i.rxAccept)&&(e=i.STRING.denied.replace("$ext",String(u.match(/\.\w{1,4}$/gi))));for(o in i.slaves)i.slaves[o]&&i.slaves[o]!=this&&i.slaves[o].value==u&&(e=i.STRING.duplicate.replace("$file",u.match(/[^\/\\]+$/gi)));return(f=n(i.clone).clone(),f.addClass("MultiFile"),e!="")?(i.error(e),i.n--,i.addSlave(f[0],r),t.parent().prepend(f),t.remove(),!1):(n(this).css({position:"absolute",top:"-3000px"}),t.after(f),i.addToList(this,r),i.addSlave(f[0],r+1),i.trigger("afterFileSelect",this,i)?void 0:!1)});n(t).data("MultiFile",i)};i.addToList=function(t,r){if(!i.trigger("onFileAppend",t,i))return!1;var e=n('<div class="MultiFile-label"><\/div>'),u=String(t.value||""),o=n('<span class="MultiFile-title" title="'+i.STRING.selected.replace("$file",u)+'">'+i.STRING.file.replace("$file",u.match(/[^\/\\]+$/gi)[0])+"<\/span>"),f=n('<a class="MultiFile-remove" href="#'+i.wrapID+'">'+i.STRING.remove+"<\/a>");return i.list.append(e.append(f," ",o)),f.click(function(){return i.trigger("onFileRemove",t,i)?(i.n--,i.current.disabled=!1,i.slaves[r]=null,n(t).remove(),n(this).parent().remove(),n(i.current).css({position:"",top:""}),n(i.current).reset().val("").attr("value","")[0].value="",!i.trigger("afterFileRemove",t,i),!1):!1}),i.trigger("afterFileAppend",t,i)?void 0:!1};i.MultiFile||i.addSlave(i.e,0);i.n++;i.E.data("MultiFile",i)})};n.extend(n.fn.MultiFile,{reset:function(){var t=n(this).data("MultiFile");return t&&t.list.find("a.MultiFile-remove").click(),n(this)},disableEmpty:function(t){t=(typeof t=="string"?t:"")||"mfD";var i=[];return n("input:file.MultiFile").each(function(){n(this).val()==""&&(i[i.length]=this)}),n(i).each(function(){this.disabled=!0}).addClass(t)},reEnableEmpty:function(t){return t=(typeof t=="string"?t:"")||"mfD",n("input:file."+t).removeClass(t).each(function(){this.disabled=!1})},intercepted:{},intercept:function(t,i,r){var e,u,f;if(r=r||[],r.constructor.toString().indexOf("Array")<0&&(r=[r]),typeof t=="function")return n.fn.MultiFile.disableEmpty(),u=t.apply(i||window,r),setTimeout(function(){n.fn.MultiFile.reEnableEmpty()},1e3),u;for(t.constructor.toString().indexOf("Array")<0&&(t=[t]),f=0;f<t.length;f++)e=t[f]+"",e&&function(t){n.fn.MultiFile.intercepted[t]=n.fn[t]||function(){};n.fn[t]=function(){return n.fn.MultiFile.disableEmpty(),u=n.fn.MultiFile.intercepted[t].apply(this,arguments),setTimeout(function(){n.fn.MultiFile.reEnableEmpty()},1e3),u}}(e)}});n.fn.MultiFile.options={accept:"",max:-1,namePattern:"$name",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(n){alert(n)}};n.fn.reset=function(){return this.each(function(){try{this.reset()}catch(n){}})};n(function(){n("input[type=file].multi").MultiFile()})}(jQuery);